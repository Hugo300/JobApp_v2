{% extends "base.html" %}

{% block title %}Templates - Job Application Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-file-alt me-2"></i>LaTeX Templates</h1>
        <p class="text-muted">Manage your CV and cover letter templates. Choose between database storage or file-based templates with sections.</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Create/Edit Template</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="name" class="form-label">Template Name *</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               placeholder="e.g., cv_classic, cover_letter_professional" required>
                        <div class="form-text">Use descriptive names like "cv_classic" or "cover_letter_professional"</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="template_type" class="form-label">Template Type</label>
                        <select class="form-select" id="template_type" name="template_type" onchange="toggleTemplateType()">
                            <option value="database">Database Template (Simple)</option>
                            <option value="file">File-based Template (With Sections)</option>
                        </select>
                        <div class="form-text">
                            <strong>Database:</strong> Simple templates stored in database<br>
                            <strong>File-based:</strong> Complex templates with section files (sections/, styles/, etc.)
                        </div>
                    </div>
                    
                    <div class="mb-3" id="content-section">
                        <label for="content" class="form-label">LaTeX Content *</label>
                        <textarea class="form-control" id="content" name="content" rows="20" 
                                  placeholder="Enter your LaTeX content here..." required></textarea>
                        <div class="form-text">
                            <strong>Available placeholders:</strong><br>
                            {{NAME}}, {{EMAIL}}, {{PHONE}}, {{LINKEDIN}}, {{GITHUB}}, {{COMPANY}}, {{JOB_TITLE}}, {{CITY}}, {{ROLE}}
                        </div>
                    </div>
                    
                    <div class="mb-3" id="file-info" style="display: none;">
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>File-based Template</h6>
                            <p class="mb-2">This template will be saved as a file in <code>documents/templates_latex/</code> and can include section files.</p>
                            <p class="mb-0"><strong>Note:</strong> Make sure to include <code>\input{sections/...}</code> commands for section files.</p>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Template
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Existing Templates</h5>
            </div>
            <div class="card-body">
                {% if templates %}
                    <div class="list-group">
                        {% for template in templates %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ template.name }}</h6>
                                <small class="text-muted">{{ template.updated_at.strftime('%Y-%m-%d') }}</small>
                            </div>
                            <span class="badge bg-{{ 'info' if template.template_type == 'file' else 'secondary' }} mb-2">
                                {{ template.template_type|title }}
                            </span>
                            <p class="mb-1 text-truncate">{{ template.get_content()[:100] }}...</p>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadTemplate('{{ template.name }}', '{{ template.template_type }}', `{{ template.get_content()|replace('\n', '\\n')|replace('"', '\\"') }}`)">
                                <i class="fas fa-edit me-1"></i>Load
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">No templates created yet.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">Template Tips</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Always include \documentclass and \begin{document}...\end{document}
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Use placeholders for dynamic content
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        File-based templates support \input{sections/...} commands
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Test your templates before using them
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">File-based Template Structure</h5>
            </div>
            <div class="card-body">
                <small class="text-muted">
                    <strong>Recommended structure:</strong><br>
                    <code>documents/templates_latex/</code><br>
                    ├── your_template.tex<br>
                    ├── _header.tex<br>
                    ├── TLCresume.sty<br>
                    └── sections/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;├── education.tex<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;├── experience.tex<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;├── skills.tex<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;└── projects.tex
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleTemplateType() {
    const templateType = document.getElementById('template_type').value;
    const contentSection = document.getElementById('content-section');
    const fileInfo = document.getElementById('file-info');
    
    if (templateType === 'file') {
        fileInfo.style.display = 'block';
        contentSection.querySelector('.form-text').innerHTML = `
            <strong>Available placeholders:</strong><br>
            {{NAME}}, {{EMAIL}}, {{PHONE}}, {{LINKEDIN}}, {{GITHUB}}, {{COMPANY}}, {{JOB_TITLE}}, {{CITY}}, {{ROLE}}<br>
            <strong>Section files:</strong> Use \\input{sections/filename} to include section files
        `;
    } else {
        fileInfo.style.display = 'none';
        contentSection.querySelector('.form-text').innerHTML = `
            <strong>Available placeholders:</strong><br>
            {{NAME}}, {{EMAIL}}, {{PHONE}}, {{LINKEDIN}}, {{GITHUB}}, {{COMPANY}}, {{JOB_TITLE}}, {{CITY}}, {{ROLE}}
        `;
    }
}

function loadTemplate(name, templateType, content) {
    document.getElementById('name').value = name;
    document.getElementById('template_type').value = templateType;
    document.getElementById('content').value = content.replace(/\\n/g, '\n');
    toggleTemplateType();
}
</script>
{% endblock %}
