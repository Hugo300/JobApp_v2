{% macro render_field(field, label_class="form-label", input_class="form-control", help_text="", placeholder="") %}
    <div class="mb-3">
        {{ field.label(class=label_class) }}
        {% if field.type == "SelectField" %}
            {{ field(class="form-select " + input_class, placeholder=placeholder) }}
        {% elif field.type == "TextAreaField" %}
            {{ field(class="form-control " + input_class, placeholder=placeholder) }}
        {% else %}
            {{ field(class=input_class, placeholder=placeholder) }}
        {% endif %}
        
        {% if help_text %}
            <div class="form-text">{{ help_text|safe }}</div>
        {% endif %}
        
        {% if field.errors %}
            <div class="text-danger">
                {% for error in field.errors %}
                    <small>{{ error }}</small>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_input_group(field, button_id, button_icon, button_text, button_onclick, label_class="form-label", input_class="form-control", help_text="", placeholder="") %}
    <div class="mb-3">
        {{ field.label(class=label_class) }}
        <div class="input-group">
            {% if placeholder %}
                {{ field(class=input_class, placeholder=placeholder) }}
            {% else %}
                {{ field(class=input_class) }}
            {% endif %}
            <button type="button" id="{{ button_id }}" class="btn btn-outline-primary" onclick="{{ button_onclick }}">
                <i class="fas {{ button_icon }}"></i>
                {{ button_text }}
            </button>
        </div>

        {% if help_text %}
            <div class="form-text">{{ help_text|safe }}</div>
        {% endif %}

        {% if field.errors %}
            <div class="text-danger">
                {% for error in field.errors %}
                    <small>{{ error }}</small>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_checkbox(field, label_class="form-check-label", input_class="form-check-input", help_text="") %}
    <div class="mb-3">
        <div class="form-check">
            {{ field(class=input_class) }}
            {{ field.label(class=label_class) }}
        </div>
        
        {% if help_text %}
            <div class="form-text">{{ help_text|safe }}</div>
        {% endif %}
        
        {% if field.errors %}
            <div class="text-danger">
                {% for error in field.errors %}
                    <small>{{ error }}</small>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_radio_group(field, label_class="form-label", help_text="") %}
    <div class="mb-3">
        {{ field.label(class=label_class) }}
        {% for subfield in field %}
            <div class="form-check">
                {{ subfield(class="form-check-input") }}
                {{ subfield.label(class="form-check-label") }}
            </div>
        {% endfor %}
        
        {% if help_text %}
            <div class="form-text">{{ help_text|safe }}</div>
        {% endif %}
        
        {% if field.errors %}
            <div class="text-danger">
                {% for error in field.errors %}
                    <small>{{ error }}</small>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_file_input(field, label_class="form-label", input_class="form-control", help_text="", accept="") %}
    <div class="mb-3">
        {{ field.label(class=label_class) }}
        {{ field(class=input_class, accept=accept) }}
        
        {% if help_text %}
            <div class="form-text">{{ help_text|safe }}</div>
        {% endif %}
        
        {% if field.errors %}
            <div class="text-danger">
                {% for error in field.errors %}
                    <small>{{ error }}</small>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_submit_button(text, icon="", btn_class="btn-primary", additional_buttons="") %}
    <div class="d-flex gap-2">
        <button type="submit" class="btn {{ btn_class }}">
            {% if icon %}<i class="{{ icon }} me-1"></i>{% endif %}{{ text }}
        </button>
        {{ additional_buttons|safe }}
    </div>
{% endmacro %}

{% macro render_form_section(title, content, icon="", collapsible=false, collapsed=false) %}
    <div class="card mb-3">
        <div class="card-header">
            {% if collapsible %}
                <h5 class="card-title mb-0">
                    <button class="btn btn-link text-decoration-none p-0 text-start w-100" type="button" 
                            data-bs-toggle="collapse" data-bs-target="#section-{{ title|replace(' ', '-')|lower }}" 
                            aria-expanded="{{ 'false' if collapsed else 'true' }}">
                        {% if icon %}<i class="{{ icon }} me-2"></i>{% endif %}{{ title }}
                        <i class="fas fa-chevron-down float-end mt-1"></i>
                    </button>
                </h5>
            {% else %}
                <h5 class="card-title mb-0">
                    {% if icon %}<i class="{{ icon }} me-2"></i>{% endif %}{{ title }}
                </h5>
            {% endif %}
        </div>
        <div class="card-body{% if collapsible %} collapse{% if not collapsed %} show{% endif %}{% endif %}" 
             {% if collapsible %}id="section-{{ title|replace(' ', '-')|lower }}"{% endif %}>
            {{ content|safe }}
        </div>
    </div>
{% endmacro %}

{% macro render_quick_form(action, method="POST", form_id="", csrf_token="", content="", submit_text="Submit", submit_icon="") %}
    <form action="{{ action }}" method="{{ method }}" {% if form_id %}id="{{ form_id }}"{% endif %}>
        {% if csrf_token %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        {% endif %}
        {{ content|safe }}
        <div class="mt-3">
            {{ render_submit_button(submit_text, submit_icon) }}
        </div>
    </form>
{% endmacro %}

{% macro render_search_form(search_value="", status_filter="", job_mode_filter="", country_filter="", 
                           status_options=[], job_mode_options=[], countries=[]) %}
    <form method="GET" class="mb-4">
        <div class="row g-3">
            <div class="col-md-4">
                <input type="text" name="search" class="form-control" placeholder="Search jobs..." 
                       value="{{ search_value }}">
            </div>
            <div class="col-md-2">
                <select name="status" class="form-select">
                    <option value="">All Statuses</option>
                    {% for status in status_options %}
                        <option value="{{ status.value }}" {% if status_filter == status.value %}selected{% endif %}>
                            {{ status.value }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="job_mode" class="form-select">
                    <option value="">All Modes</option>
                    {% for mode in job_mode_options %}
                        <option value="{{ mode.value }}" {% if job_mode_filter == mode.value %}selected{% endif %}>
                            {{ mode.value }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="country" class="form-select">
                    <option value="">All Countries</option>
                    {% for country in countries %}
                        <option value="{{ country }}" {% if country_filter == country %}selected{% endif %}>
                            {{ country }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-1"></i>Search
                </button>
            </div>
        </div>
    </form>
{% endmacro %}

{% macro render_character_counter(field_id, max_length, current_length=0) %}
    <div class="d-flex justify-content-between align-items-center">
        <small class="form-text text-muted">Maximum {{ max_length }} characters</small>
        <small class="form-text">
            <span id="{{ field_id }}CharCount">{{ current_length }}</span>/{{ max_length }}
        </small>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const field = document.getElementById('{{ field_id }}');
            const counter = document.getElementById('{{ field_id }}CharCount');
            
            if (field && counter) {
                field.addEventListener('input', function() {
                    const currentLength = field.value.length;
                    counter.textContent = currentLength;
                    
                    if (currentLength > {{ max_length * 0.8 }}) {
                        counter.className = 'text-warning';
                    } else if (currentLength > {{ max_length * 0.95 }}) {
                        counter.className = 'text-danger';
                    } else {
                        counter.className = '';
                    }
                });
            }
        });
    </script>
{% endmacro %}
