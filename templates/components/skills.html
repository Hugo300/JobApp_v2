{% macro render_skill_tag(skill, category=None, count=None, removable=false, clickable=false, size='normal') %}
    {% set tag_class = 'skill-tag' %}
    {% if size == 'small' %}
        {% set tag_class = tag_class + ' skill-tag-sm' %}
    {% elif size == 'large' %}
        {% set tag_class = tag_class + ' skill-tag-lg' %}
    {% endif %}
    
    {% if clickable %}
        {% set tag_class = tag_class + ' skill-tag-clickable' %}
    {% endif %}
    
    <span class="{{ tag_class }}" 
          {% if category %}style="background-color: {{ category.color or '#6c757d' }}20; border-color: {{ category.color or '#6c757d' }};"{% endif %}
          data-skill="{{ skill }}"
          {% if category %}data-category="{{ category.name }}"{% endif %}>
        
        {% if category and category.icon %}
            <i class="{{ category.icon }} me-1"></i>
        {% endif %}
        
        {{ skill }}
        
        {% if count %}
            <span class="skill-count ms-1">{{ count }}</span>
        {% endif %}
        
        {% if removable %}
            <button type="button" class="btn-close btn-close-sm ms-1" 
                    onclick="removeSkill('{{ skill }}')" 
                    aria-label="Remove {{ skill }}"></button>
        {% endif %}
    </span>
{% endmacro %}

{% macro render_skill_list(skills, title=None, show_categories=true, show_counts=false, removable=false, max_display=None) %}
    <div class="skill-list">
        {% if title %}
            <h6 class="skill-list-title">{{ title }}</h6>
        {% endif %}
        
        {% if skills %}
            <div class="skill-tags-container">
                {% for skill_data in skills[:max_display] if max_display else skills %}
                    {% if skill_data is string %}
                        {{ render_skill_tag(skill_data, removable=removable) }}
                    {% else %}
                        {{ render_skill_tag(
                            skill_data.skill or skill_data.name or skill_data,
                            category=skill_data.category if show_categories else None,
                            count=skill_data.count if show_counts else None,
                            removable=removable
                        ) }}
                    {% endif %}
                {% endfor %}
                
                {% if max_display and skills|length > max_display %}
                    <span class="skill-tag skill-tag-more">
                        +{{ skills|length - max_display }} more
                    </span>
                {% endif %}
            </div>
        {% else %}
            <p class="text-muted mb-0">No skills found</p>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_skill_category_card(category, skills, show_actions=true) %}
    <div class="card skill-category-card mb-3" data-category-id="{{ category.id }}">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                {% if category.icon %}
                    <i class="{{ category.icon }} me-2" style="color: {{ category.color or '#6c757d' }};"></i>
                {% endif %}
                <h6 class="mb-0">{{ category.name }}</h6>
                <span class="badge bg-secondary ms-2">{{ skills|length }}</span>
            </div>
            
            {% if show_actions %}
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="editCategory({{ category.id }})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger" onclick="deleteCategory({{ category.id }})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            {% endif %}
        </div>
        
        <div class="card-body">
            {% if category.description %}
                <p class="text-muted small mb-2">{{ category.description }}</p>
            {% endif %}
            
            {{ render_skill_list(skills, show_categories=false, show_counts=true) }}
        </div>
    </div>
{% endmacro %}

{% macro render_skill_match_indicator(match_percentage, size='normal') %}
    {% set color_class = 'success' if match_percentage >= 80 else 'warning' if match_percentage >= 60 else 'danger' %}
    {% set size_class = 'progress-sm' if size == 'small' else 'progress-lg' if size == 'large' else '' %}
    
    <div class="skill-match-indicator">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <small class="text-muted">Skill Match</small>
            <small class="fw-bold text-{{ color_class }}">{{ match_percentage }}%</small>
        </div>
        <div class="progress {{ size_class }}">
            <div class="progress-bar bg-{{ color_class }}" 
                 role="progressbar" 
                 style="width: {{ match_percentage }}%"
                 aria-valuenow="{{ match_percentage }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_skill_gap_analysis(missing_skills, matched_skills, total_required) %}
    <div class="skill-gap-analysis">
        <div class="row">
            <div class="col-md-4">
                <div class="text-center">
                    <div class="h4 text-success mb-1">{{ matched_skills|length }}</div>
                    <small class="text-muted">Matched Skills</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <div class="h4 text-warning mb-1">{{ missing_skills|length }}</div>
                    <small class="text-muted">Missing Skills</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <div class="h4 text-info mb-1">{{ total_required }}</div>
                    <small class="text-muted">Total Required</small>
                </div>
            </div>
        </div>
        
        {% if missing_skills %}
            <div class="mt-3">
                <h6 class="text-warning">Skills to Learn:</h6>
                {{ render_skill_list(missing_skills, show_categories=true) }}
            </div>
        {% endif %}
        
        {% if matched_skills %}
            <div class="mt-3">
                <h6 class="text-success">Your Matching Skills:</h6>
                {{ render_skill_list(matched_skills, show_categories=true) }}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_skill_recommendation_card(recommendation) %}
    <div class="card skill-recommendation-card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-1">
                        {{ render_skill_tag(recommendation.skill, category=recommendation.category) }}
                    </h6>
                    <p class="card-text text-muted small mb-2">{{ recommendation.reason }}</p>
                </div>
                <div class="text-end">
                    {% set priority_class = 'success' if recommendation.priority == 'high' else 'warning' if recommendation.priority == 'medium' else 'secondary' %}
                    <span class="badge bg-{{ priority_class }}">{{ recommendation.priority|title }}</span>
                </div>
            </div>
            
            <div class="row text-center">
                {% if recommendation.growth_rate %}
                    <div class="col">
                        <small class="text-success fw-bold">+{{ recommendation.growth_rate }}%</small>
                        <br><small class="text-muted">Growth</small>
                    </div>
                {% endif %}
                
                {% if recommendation.success_rate %}
                    <div class="col">
                        <small class="text-info fw-bold">{{ recommendation.success_rate }}%</small>
                        <br><small class="text-muted">Success Rate</small>
                    </div>
                {% endif %}
                
                {% if recommendation.estimated_learning_time %}
                    <div class="col">
                        <small class="text-warning fw-bold">{{ recommendation.estimated_learning_time }}w</small>
                        <br><small class="text-muted">Learning Time</small>
                    </div>
                {% endif %}
            </div>
            
            <div class="mt-2">
                <button class="btn btn-sm btn-outline-primary me-2" onclick="addSkillToProfile('{{ recommendation.skill }}')">
                    <i class="fas fa-plus me-1"></i>Add to Profile
                </button>
                <button class="btn btn-sm btn-outline-info" onclick="viewLearningResources('{{ recommendation.skill }}')">
                    <i class="fas fa-book me-1"></i>Learn More
                </button>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_skill_analytics_chart(chart_id, title, chart_type='bar') %}
    <div class="skill-analytics-chart">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">{{ title }}</h6>
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" onclick="changeChartType('{{ chart_id }}', 'bar')">
                    <i class="fas fa-chart-bar"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="changeChartType('{{ chart_id }}', 'pie')">
                    <i class="fas fa-chart-pie"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="changeChartType('{{ chart_id }}', 'line')">
                    <i class="fas fa-chart-line"></i>
                </button>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="{{ chart_id }}" data-chart-type="{{ chart_type }}"></canvas>
        </div>
        
        <div class="chart-loading d-none">
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted mt-2">Loading chart data...</p>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_skill_search_form(placeholder="Search skills...", show_filters=true) %}
    <form class="skill-search-form" onsubmit="return false;">
        <div class="row">
            <div class="col-md-8">
                <div class="input-group">
                    <input type="text" 
                           class="form-control" 
                           placeholder="{{ placeholder }}"
                           id="skillSearchInput"
                           autocomplete="off">
                    <button class="btn btn-outline-secondary" type="button" onclick="clearSkillSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="btn btn-primary" type="button" onclick="searchSkills()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            {% if show_filters %}
                <div class="col-md-4">
                    <select class="form-select" id="skillCategoryFilter" onchange="filterSkillsByCategory()">
                        <option value="">All Categories</option>
                        <option value="programming">Programming Languages</option>
                        <option value="web">Web Technologies</option>
                        <option value="cloud">Cloud & DevOps</option>
                        <option value="database">Databases</option>
                        <option value="mobile">Mobile Development</option>
                        <option value="design">Design & UX</option>
                        <option value="soft">Soft Skills</option>
                    </select>
                </div>
            {% endif %}
        </div>
        
        <div class="skill-search-suggestions mt-2 d-none">
            <div class="list-group">
                <!-- Suggestions will be populated by JavaScript -->
            </div>
        </div>
    </form>
{% endmacro %}

<style>
.skill-tag {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    margin: 0.125rem;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    color: #495057;
    text-decoration: none;
    transition: all 0.15s ease-in-out;
}

.skill-tag-sm {
    padding: 0.125rem 0.375rem;
    font-size: 0.75rem;
}

.skill-tag-lg {
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
}

.skill-tag-clickable {
    cursor: pointer;
}

.skill-tag-clickable:hover {
    background-color: #e9ecef;
    border-color: #adb5bd;
    transform: translateY(-1px);
}

.skill-tag-more {
    background-color: #6c757d;
    color: white;
    border-color: #6c757d;
}

.skill-count {
    background-color: #6c757d;
    color: white;
    border-radius: 0.25rem;
    padding: 0.125rem 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.skill-category-card {
    transition: all 0.2s ease-in-out;
}

.skill-category-card:hover {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transform: translateY(-1px);
}

.skill-match-indicator .progress {
    height: 0.5rem;
}

.skill-match-indicator .progress-sm {
    height: 0.375rem;
}

.skill-match-indicator .progress-lg {
    height: 0.75rem;
}

.skill-recommendation-card {
    border-left: 4px solid #007bff;
    transition: all 0.2s ease-in-out;
}

.skill-recommendation-card:hover {
    box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.skill-analytics-chart .chart-container {
    position: relative;
    height: 300px;
}

.skill-search-suggestions {
    position: absolute;
    z-index: 1000;
    width: 100%;
    max-height: 200px;
    overflow-y: auto;
}
</style>
